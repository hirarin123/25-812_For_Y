<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>マーダーミステリーRPG</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
html, body { margin:0; padding:0; height:100%; background:#000; font-family:'Yu Gothic',sans-serif; color:#ffeebb; }
.scene { display:none; min-height:100vh; width:100vw; flex-direction:column; align-items:center; justify-content:center; }
.scene.active { display:flex; }
button { font-size:22px; background:#ffe688; color:#502800; font-weight:bold; border-radius:10px; border:none; padding:14px 36px; margin:12px; cursor:pointer; }
.narration { font-size:24px; line-height:1.8; background:#222a; padding:24px; border-radius:14px; max-width:720px; text-align:left; }
.char { opacity:0; filter:blur(2px); display:inline-block; }
.char.show { opacity:1; filter:blur(0); transition: opacity .25s ease, filter .4s ease; }
@keyframes slideRight { 0% { transform: translateX(-100%); opacity:0; } 10% { opacity:1; } 90% { opacity:1; } 100% { transform: translateX(100%); opacity:0; } }
.slide { animation: slideRight 30s linear forwards; }
#audioBar { position:fixed; right:14px; bottom:14px; display:flex; gap:8px; background:#000a; padding:8px 12px; border-radius:12px; }
#soundPrompt { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(180deg,#0008,#000c); z-index:900; }
#soundPrompt .card { background:#1a1a22; padding:20px; border-radius:14px; text-align:center; }
</style>
</head>
<body>
<div id="intro" class="scene active" style="background:#181818 url('intro_bg.png') center/cover no-repeat;">
  <button id="startAdventureBtn">冒険を始める</button>
</div>
<div id="story" class="scene" style="background:#000;">
  <div class="narration"><span id="storyText"></span></div>
  <button id="toSlideBtn" style="display:none;">次へ</button>
</div>
<div id="slideScene" class="scene" style="background:#000;">
  <img id="slideImg" style="max-height:78vh;" />
</div>
<audio id="bgm" src="bgm.mp3" preload="auto" loop></audio>
<div id="audioBar">
  <button id="playPauseBtn">▶ 再生</button>
  <button id="muteBtn">🔊 ミュート</button>
</div>
<div id="soundPrompt">
  <div class="card">
    <div class="title">サウンドをオンにしますか？</div>
    <div>ブラウザの制限で自動再生できません。<br>下のボタンでBGMを開始してください。</div>
    <button id="enableSoundBtn" style="margin-top:12px;">▶ BGMを再生</button>
    <button id="skipSoundBtn" style="margin-top:10px;background:#555;color:#fff;">BGMなしで進む</button>
  </div>
</div>
  
<script>
const STORY_TEXT = '目を覚ますと、あなたは薄暗い診療所のベッドに横たわっていた。\n視界の先には、優しい眼差しの Dr. Sung。\n\n「…この村は、ある出来事を境に静まり返ってしまいました。」\nその声は静かで、しかし深い悲しみを帯びていた。\n\nここは、かつて祭りと笑い声に包まれていた小さな村。\nだが今は、人影もなく、風が軋む音だけが響いている。\n\n診療所の扉を開けると、一匹のパグがこちらを見上げていた。\n首には古びた鍵。その名は ルシア。\nその瞳には、あなたに何かを訴える強い光が宿っていた。\n\nルシアが歩き出す。足元から、くしゃくしゃになった紙切れが舞い落ちた。\nそこには震える筆跡でこう記されている。\n\n「宝を見つけた者は、この村の真実を知る」\n\n噂によれば、“ヴェルミリオン”と呼ばれる者が現れ、村を滅ぼす呪文を放とうとした。\nその呪文を封じる術を知る者はただ一人――だがその人物は忽然と姿を消し、村は不思議な力で閉ざされてしまったという。\n\nあなたはルシアに導かれ、村に散らばる暗号を解くことを決意する。\nひとつ謎を解くたびに、地図の封印が解け、何かの“断片”が集まっていく。\nしかし、すべてを集められなければ――村は永遠に静寂に閉ざされるだろう。\n';
const SLIDE_IMAGES = ['LuciaQR.png', 'NazoQR.png'];
const scenes = { intro:document.getElementById('intro'), story:document.getElementById('story'), slide:document.getElementById('slideScene') };
function showScene(key){ Object.values(scenes).forEach(s=>s.classList.remove('active')); scenes[key].classList.add('active'); if(key==='story') startTypewriterStory(); }
function startTypewriterStory(){ const textEl=document.getElementById('storyText'); const btn=document.getElementById('toSlideBtn'); textEl.innerHTML=''; btn.style.display='none'; const nodes=[]; for(const ch of STORY_TEXT){ if(ch==='\n'){ nodes.push(document.createElement('br')); } else { const sp=document.createElement('span'); sp.className='char'; sp.textContent=ch; nodes.push(sp);} } nodes.forEach(n=>textEl.appendChild(n)); let i=0; const timer=setInterval(()=>{ while(i<nodes.length && nodes[i].tagName==='BR'){i++;} if(i<nodes.length){ nodes[i].classList.add('show'); i++; } else { clearInterval(timer); btn.style.display='inline-block'; } },35); }
function runSlides(){ const img=document.getElementById('slideImg'); let index=0; function nextSlide(){ if(index>=SLIDE_IMAGES.length) return; img.classList.remove('slide'); void img.offsetWidth; img.onload=()=>{ img.classList.add('slide'); setTimeout(()=>{ index++; nextSlide(); },35000); }; img.src=SLIDE_IMAGES[index]; }
  nextSlide();
}

                     
const bgm=document.getElementById('bgm');
let soundConfigured = false;
document.getElementById('playPauseBtn').onclick=()=>{ if(bgm.paused) bgm.play(); else bgm.pause();};
document.getElementById('muteBtn').onclick=()=>{ bgm.muted=!bgm.muted;};
document.getElementById('enableSoundBtn').onclick = async () => {
  try { await bgm.play(); } catch (e) {}
  soundConfigured = true;
  document.getElementById('soundPrompt').style.display = 'none';
  showScene('intro');
};
document.getElementById('skipSoundBtn').onclick = () => {
  try { bgm.pause(); } catch(e) {}
  soundConfigured = true;
  document.getElementById('soundPrompt').style.display = 'none';
  showScene('intro');
};
document.getElementById('startAdventureBtn').onclick = () => {
  if (!soundConfigured) {
    document.getElementById('soundPrompt').style.display = 'flex';
  } else {
    showScene('story');
  }
};
document.getElementById('toSlideBtn').onclick=()=>{ showScene('slide'); runSlides(); };
</script>
</body>
</html>
